{"ast":null,"code":"var rp = require('request-promise').defaults({\n  json: true\n});\n\nconst api_root = 'https://min-api.cryptocompare.com';\nconst history = {};\nexport default {\n  history: history,\n  getBars: function (symbolInfo, resolution, from, to, first, limit) {\n    var split_symbol = symbolInfo.name.split(/[:/]/);\n    const url = resolution === 'D' ? '/data/histoday' : resolution >= 60 ? '/data/histohour' : '/data/histominute';\n    const qs = {\n      e: split_symbol[0],\n      fsym: split_symbol[1],\n      tsym: split_symbol[2],\n      toTs: to ? to : '',\n      limit: limit ? limit : 2000 // aggregate: 1//resolution \n\n    }; // console.log({qs})\n\n    console.log(`${api_root}${url}`, qs);\n    return rp({\n      url: `${api_root}${url}`,\n      qs\n    }).then(data => {\n      console.log({\n        data\n      });\n\n      if (data.Response && data.Response === 'Error') {\n        console.log('CryptoCompare API error:', data.Message);\n        return [];\n      }\n\n      if (data.Data.length) {\n        console.log(`Actually returned: ${new Date(data.TimeFrom * 1000).toISOString()} - ${new Date(data.TimeTo * 1000).toISOString()}`);\n        var bars = data.Data.map(el => {\n          return {\n            time: el.time * 1000,\n            //TradingView requires bar time in ms\n            low: el.low,\n            high: el.high,\n            open: el.open,\n            close: el.close,\n            volume: el.volumefrom\n          };\n        }); //const bars2 = bars\n\n        if (first) {\n          var lastBar = bars[bars.length - 1];\n          history[symbolInfo.name] = {\n            lastBar: lastBar\n          };\n        }\n\n        console.log(bars);\n        return bars;\n      } else {\n        return [];\n      }\n    });\n  }\n};","map":{"version":3,"sources":["/mnt/c/users/gianni/desktop/2/cooperaty-app/src/components/TradingView/api/historyProvider.js"],"names":["rp","require","defaults","json","api_root","history","getBars","symbolInfo","resolution","from","to","first","limit","split_symbol","name","split","url","qs","e","fsym","tsym","toTs","console","log","then","data","Response","Message","Data","length","Date","TimeFrom","toISOString","TimeTo","bars","map","el","time","low","high","open","close","volume","volumefrom","lastBar"],"mappings":"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","sourcesContent":["var rp = require('request-promise').defaults({json: true})\n\nconst api_root = 'https://min-api.cryptocompare.com'\nconst history = {}\n\nexport default {\n\thistory: history,\n\n    getBars: function(symbolInfo, resolution, from, to, first, limit) {\n\t\tvar split_symbol = symbolInfo.name.split(/[:/]/)\n\t\t\tconst url = resolution === 'D' ? '/data/histoday' : resolution >= 60 ? '/data/histohour' : '/data/histominute'\n\t\t\tconst qs = {\n\t\t\t\t\te: split_symbol[0],\n\t\t\t\t\tfsym: split_symbol[1],\n\t\t\t\t\ttsym: split_symbol[2],\n\t\t\t\t\ttoTs:  to ? to : '',\n\t\t\t\t\tlimit: limit ? limit : 2000, \n\t\t\t\t\t// aggregate: 1//resolution \n\t\t\t\t}\n\t\t\t// console.log({qs})\n\t\tconsole.log(`${api_root}${url}`,qs)\t\t\n        return rp({\n                url: `${api_root}${url}`,qs\n            })\n            .then(data => {\n                console.log({data})\n\t\t\t\tif (data.Response && data.Response === 'Error') {\n\t\t\t\t\tconsole.log('CryptoCompare API error:',data.Message)\n\t\t\t\t\treturn []\n\t\t\t\t}\n\t\t\t\tif (data.Data.length) {\n\t\t\t\t\tconsole.log(`Actually returned: ${new Date(data.TimeFrom * 1000).toISOString()} - ${new Date(data.TimeTo * 1000).toISOString()}`)\n\t\t\t\t\tvar bars = data.Data.map(el => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\ttime: el.time * 1000, //TradingView requires bar time in ms\n\t\t\t\t\t\t\tlow: el.low,\n\t\t\t\t\t\t\thigh: el.high,\n\t\t\t\t\t\t\topen: el.open,\n\t\t\t\t\t\t\tclose: el.close,\n\t\t\t\t\t\t\tvolume: el.volumefrom \n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t//const bars2 = bars\n\t\t\t\t\t\tif (first) {\n\t\t\t\t\t\t\tvar lastBar = bars[bars.length - 1]\n\t\t\t\t\t\t\thistory[symbolInfo.name] = {lastBar: lastBar}\n\t\t\t\t\t\t}\n\t\t\t\t\tconsole.log(bars)\t\n\t\t\t\t\treturn bars\n\t\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\treturn []\n\t\t\t\t}\n\t\t\t})\n}\n}\n"]},"metadata":{},"sourceType":"module"}